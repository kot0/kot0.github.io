<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù†Ø±Ø¯Ø§Øª Ø­ÙŠØ¯Ø± ÙˆÙ…Ø±ÙŠÙ…</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-main: 'Cairo', sans-serif;
        }
        .theme-default {
            --primary-color: #2d3436; --secondary-color: #0984e3; --background-color: #dfe6e9;
            --surface-color: #ffffff; --text-color: #2d3436; --accent-color: #00cec9; --danger-color: #d63031;
        }
        .theme-dark {
            --primary-color: #ecf0f1; --secondary-color: #e67e22; --background-color: #2c3e50;
            --surface-color: #34495e; --text-color: #ecf0f1; --accent-color: #1abc9c; --danger-color: #e74c3c;
        }
        .theme-forest {
            --primary-color: #fefae0; --secondary-color: #606c38; --background-color: #dda15e;
            --surface-color: #fefae0; --text-color: #283618; --accent-color: #bc6c25; --danger-color: #d00000;
        }
        .theme-pink {
            --primary-color: #ad1457; --secondary-color: #ec407a; --background-color: #fce4ec;
            --surface-color: #ffffff; --text-color: #3e2723; --accent-color: #f06292; --danger-color: #d32f2f;
        }
        .theme-neon {
            --primary-color: #e040fb; --secondary-color: #f50057; --background-color: #1a0a24;
            --surface-color: #2c1d3c; --text-color: #f0f; --accent-color: #00e5ff; --danger-color: #ff1744;
        }
        body {
            font-family: var(--font-main);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; justify-content: center; align-items: flex-start;
            min-height: 100vh;
            transition: background-color 0.5s, color 0.5s;
        }
        .container {
            width: 100%; max-width: 900px; background: var(--surface-color); padding: 25px;
            border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); transition: background-color 0.5s;
        }
        h1 { text-align: center; margin-bottom: 5px; }
        h2 { text-align: center; }
        .developer-credit { text-align: center; margin-top: 0; margin-bottom: 20px; opacity: 0.7; font-size: 0.9em; }
        button {
            border: none; color: white; font-size: 16px; font-family: var(--font-main); cursor: pointer;
            border-radius: 8px; padding: 12px 20px; background-color: var(--secondary-color);
            transition: all 0.2s ease; width: 100%;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        button:active { transform: translateY(0); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }
        input, select {
            padding: 10px; border: 2px solid #ccc; border-radius: 8px; font-size: 16px;
            font-family: var(--font-main); width: 100%; box-sizing: border-box; margin-bottom: 10px;
        }
        hr { border: none; height: 1px; background-color: rgba(0,0,0,0.1); margin: 20px 0; }
        .screen { display: none; opacity: 0; transition: opacity 0.4s ease-in-out; }
        .screen.active { display: block; opacity: 1; }
        #setup-screen ul { list-style: none; padding: 0; }
        #setup-screen li { background-color: rgba(0,0,0,0.05); padding: 10px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; }
        .delete-btn { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 20px; }
        .avatar-picker { text-align: center; margin-bottom: 15px; }
        .avatar { cursor: pointer; font-size: 2em; margin: 0 5px; transition: transform 0.2s; display: inline-block; }
        .avatar:hover { transform: scale(1.2); }
        .avatar.selected { border-bottom: 4px solid var(--accent-color); border-radius: 5px; }
        .game-layout { display: flex; flex-wrap: wrap; gap: 20px; }
        .keypad-section { flex-grow: 1; min-width: 300px; position: relative; display: flex; flex-direction: column; align-items: center; }
        .number-display { background-color: rgba(0,0,0,0.1); border-radius: 10px; padding: 15px; font-size: 2.5em; text-align: center; margin-bottom: 15px; min-height: 60px; font-weight: bold; width: 100%; }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .keypad button { font-size: 1.5em; padding: 20px; background-color: var(--primary-color); }
        .keypad .action-btn { background-color: var(--accent-color); }
        .sidebar { width: 100%; max-width: 300px; flex-shrink: 0; }
        #scoreboard { list-style: none; padding: 0; }
        #scoreboard li { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1); font-size: 1.1em; transition: all 0.3s; }
        #scoreboard li.highlight { background-color: var(--accent-color); color: white; border-radius: 5px; transform: scale(1.05); }
        #scoreboard li .score { font-weight: bold; }
        #history-log { list-style: none; padding: 10px; background-color: rgba(0,0,0,0.05); border-radius: 5px; height: 150px; overflow-y: auto; }
        #history-log li { opacity: 0.9; font-size: 0.9em; padding: 5px; border-bottom: 1px dashed rgba(0,0,0,0.1); }
        .theme-switcher { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
        .theme-switcher button { width: auto; padding: 8px 15px; }
        #theme-default { background-color: #0984e3; } #theme-dark { background-color: #2c3e50; } #theme-forest { background-color: #606c38; } #theme-pink { background-color: #ec407a; } #theme-neon { background-color: #f50057; }
        .dice-container-3d { margin-bottom: 20px; perspective: 1000px; display: flex; justify-content: center; align-items: center; height: 80px; }
        .dice { width: 60px; height: 60px; position: relative; transform-style: preserve-3d; animation: spin 12s infinite linear; }
        @keyframes spin { from { transform: rotateX(0deg) rotateY(0deg); } to { transform: rotateX(360deg) rotateY(360deg); } }
        .face { position: absolute; width: 60px; height: 60px; background: linear-gradient(145deg, #ffd700, #f0c000); border: 2px solid #b8860b; border-radius: 5px; box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); display: flex; justify-content: space-around; align-items: center; padding: 8px; box-sizing: border-box; }
        .dot { width: 12px; height: 12px; background-color: #3a2d0c; border-radius: 50%; box-shadow: inset 2px 2px 3px rgba(0,0,0,0.7); }
        .front { transform: translateZ(30px); } .back { transform: rotateY(180deg) translateZ(30px); } .right { transform: rotateY(90deg) translateZ(30px); } .left { transform: rotateY(-90deg) translateZ(30px); } .top { transform: rotateX(90deg) translateZ(30px); } .bottom { transform: rotateX(-90deg) translateZ(30px); }
        .face .dot-col { display: flex; flex-direction: column; justify-content: space-between; height: 100%; } .f-1 { justify-content: center; } .f-2 .dot:nth-of-type(1) { align-self: flex-start; } .f-2 .dot:nth-of-type(2) { align-self: flex-end; } .f-3 .dot:nth-of-type(1) { align-self: flex-start; } .f-3 .dot:nth-of-type(2) { align-self: center; } .f-3 .dot:nth-of-type(3) { align-self: flex-end; } .f-4 { justify-content: space-between; } .f-5 { justify-content: space-between; } .f-5 .dot-col:nth-of-type(2) { justify-content: center; } .f-6 { justify-content: space-between; }
        #confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .confetti { position: absolute; top: -20px; width: 15px; height: 15px; opacity: 1; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(105vh) rotate(720deg); opacity: 0; } }
        #game-over-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        #game-over-modal.active { display: flex; }
        .modal-content { background: var(--surface-color); color: var(--text-color); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); transform: scale(0.7); opacity: 0; animation: pop-in 0.5s 0.2s forwards cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes pop-in { to { transform: scale(1); opacity: 1; } }
        .modal-content h2 { font-size: 2em; margin-top: 0; }
        .modal-content p { font-size: 3em; margin: 10px 0; font-weight: bold; color: var(--accent-color); }
        #play-again-btn { margin-top: 20px; width: auto; padding: 15px 30px; font-size: 1.2em; }
        @keyframes float-up { from { opacity: 1; transform: translateY(0) scale(1); } to { opacity: 0; transform: translateY(-100px) scale(1.5); } }
        .floating-score { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); font-size: 3em; font-weight: bold; pointer-events: none; animation: float-up 1.5s ease-out forwards; }
        .floating-score.positive { color: #2ecc71; }
        .floating-score.negative { color: var(--danger-color); }
    </style>
</head>
<body class="theme-default">
<div id="confetti-container"></div>

<div class="container">
    <div id="setup-screen" class="screen active">
        <h1>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù†Ø±Ø¯Ø§Øª Ø­ÙŠØ¯Ø± ÙˆÙ…Ø±ÙŠÙ…</h1>
        <p class="developer-credit">Ø§Ù„Ù…Ø·ÙˆØ±: Ù‚ÙŠØªÙˆ</p>
        <div id="avatar-picker" class="avatar-picker">
            <p style="margin: 0 0 10px 0;">Ø§Ø®ØªØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„Ø§Ø¹Ø¨:</p>
            <span class="avatar selected">ğŸ‘¨â€ğŸš€</span><span class="avatar">ğŸ¦¸â€â™€ï¸</span><span class="avatar">ğŸ¦Š</span>
            <span class="avatar">ğŸ§™</span><span class="avatar">ğŸ¤–</span><span class="avatar">ğŸ¦„</span>
        </div>
        <input type="text" id="player-name-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù‡Ù†Ø§">
        <button onclick="addPlayer()">Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨</button>
        <ul id="players-list"></ul>
        <hr>
        <label for="target-score-input" style="display: block; text-align: center; margin-bottom: 5px;">Ø§Ù„Ù‡Ø¯Ù Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡:</label>
        <input type="number" id="target-score-input" value="150" placeholder="Ø§Ù„Ù‡Ø¯Ù (Ù…Ø«Ø§Ù„: 150)">
        
        <label for="prize-name-input" style="display: block; text-align: center; margin-bottom: 5px; margin-top: 10px;">Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
        <input type="text" id="prize-name-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ù‡Ù†Ø§">
        
        <button id="start-game-btn" onclick="startGame()" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>

    <div id="game-screen" class="screen">
        <div style="text-align: center; margin-bottom: 10px;">
            <p style="font-size: 1.2em; margin: 0;">Ø§Ù„Ù‡Ø¯Ù: <b id="display-target-score">150</b></p>
        </div>
        <div class="game-layout">
            <div class="keypad-section">
                <div class="dice-container-3d">
                    <div class="dice">
                        <div class="face front f-1"><span class="dot"></span></div>
                        <div class="face back f-6"><div class="dot-col"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div><div class="dot-col"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div></div>
                        <div class="face right f-3"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
                        <div class="face left f-4"><div class="dot-col"><span class="dot"></span><span class="dot"></span></div><div class="dot-col"><span class="dot"></span><span class="dot"></span></div></div>
                        <div class="face top f-5"><div class="dot-col"><span class="dot"></span><span class="dot"></span></div><div class="dot-col"><span class="dot"></span></div><div class="dot-col"><span class="dot"></span><span class="dot"></span></div></div>
                        <div class="face bottom f-2"><span class="dot"></span><span class="dot"></span></div>
                    </div>
                </div>
                <div class="number-display" id="number-display">&nbsp;</div>
                <div class="keypad">
                    <script>for(let i=1; i<=9; i++) document.write(`<button onclick="appendNumber('${i}')">${i}</button>`);</script>
                    <button class="action-btn" onclick="clearInput()">Ù…Ø³Ø­</button>
                    <button onclick="appendNumber('0')">0</button>
                    <button class="action-btn" onclick="submitNumber()">Ø£Ø¯Ø®Ù„</button>
                </div>
            </div>
            <div class="sidebar">
                <h3>Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰:</h3>
                <select id="current-player-select"></select>
                <h3 style="margin-top: 20px;">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                <ul id="scoreboard"></ul>
                <h3 style="margin-top: 20px;">Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª</h3>
                <ul id="history-log"></ul>

                <hr>
                <h3>Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨</h3>
                <div id="ingame-avatar-picker" class="avatar-picker">
                    <span class="avatar selected">ğŸ‘¨â€ğŸš€</span><span class="avatar">ğŸ¦¸â€â™€ï¸</span><span class="avatar">ğŸ¦Š</span>
                </div>
                <input type="text" id="ingame-player-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <button onclick="addPlayerDuringGame()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>
        <div class="theme-switcher">
            <button id="theme-default" onclick="changeTheme('theme-default')">Ø£Ø³Ø§Ø³ÙŠ</button>
            <button id="theme-dark" onclick="changeTheme('theme-dark')">Ù…Ø¸Ù„Ù…</button>
            <button id="theme-forest" onclick="changeTheme('theme-forest')">ØºØ§Ø¨Ø©</button>
            <button id="theme-pink" onclick="changeTheme('theme-pink')">ÙˆØ±Ø¯ÙŠ</button>
            <button id="theme-neon" onclick="changeTheme('theme-neon')">Ù†ÙŠÙˆÙ†</button>
        </div>
        <button onclick="goToSetup()" style="margin-top: 20px; background-color: #7f8c8d;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
</div>

<div id="game-over-modal">
    <div class="modal-content">
        <h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
        <p id="winner-name"></p>
        <p id="prize-display"></p>
        <button id="play-again-btn" onclick="playAgain()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>
</div>

<audio id="audio-click" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2825a60377.mp3?filename=button-pressed-38129.mp3"></audio>
<audio id="audio-roll" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0a50b37.mp3?filename=dice-142528.mp3"></audio>
<audio id="audio-positive" src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_450a4e5a38.mp3?filename=success-1-6297.mp3"></audio>
<audio id="audio-negative" src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_c38a2cce35.mp3?filename=negative_beeps-6008.mp3"></audio>

<script>
    // State
    let players = [];
    let currentInput = '';
    let selectedAvatar = 'ğŸ‘¨â€ğŸš€';
    let targetScore = 150;
    let isGameOver = false;
    let prizeName = '';
    let currentPlayerIndex = 0;

    // DOM Elements
    const body = document.body;
    const setupScreen = document.getElementById('setup-screen');
    const gameScreen = document.getElementById('game-screen');
    const playerNameInput = document.getElementById('player-name-input');
    const playersList = document.getElementById('players-list');
    const startGameBtn = document.getElementById('start-game-btn');
    const targetScoreInput = document.getElementById('target-score-input');
    const prizeNameInput = document.getElementById('prize-name-input');
    const displayTargetScore = document.getElementById('display-target-score');
    const numberDisplay = document.getElementById('number-display');
    const playerSelect = document.getElementById('current-player-select');
    const scoreboard = document.getElementById('scoreboard');
    const keypadSection = document.querySelector('.keypad-section');
    const historyLog = document.getElementById('history-log');
    const gameOverModal = document.getElementById('game-over-modal');
    const winnerNameEl = document.getElementById('winner-name');
    const prizeDisplayEl = document.getElementById('prize-display');
    const confettiContainer = document.getElementById('confetti-container');
    const ingamePlayerNameInput = document.getElementById('ingame-player-name-input');
    const ingameAvatarPicker = document.getElementById('ingame-avatar-picker');
    
    // Audio Elements
    const audioClick = document.getElementById('audio-click');
    const audioRoll = document.getElementById('audio-roll');
    const audioPositive = document.getElementById('audio-positive');
    const audioNegative = document.getElementById('audio-negative');

    function playSound(audioEl) {
        audioEl.currentTime = 0;
        audioEl.play().catch(e => console.log("Sound play failed:", e));
    }

    // --- Setup ---
    document.querySelectorAll('.avatar-picker').forEach(picker => {
        picker.querySelectorAll('.avatar').forEach(a => a.onclick = () => {
            picker.querySelector('.avatar.selected')?.classList.remove('selected');
            a.classList.add('selected');
        });
    });

    function addPlayer() {
        const name = playerNameInput.value.trim();
        const avatar = document.querySelector('#setup-screen .avatar.selected').textContent;
        if (name && !players.some(p => p.name === name)) {
            players.push({ name, score: 0, avatar });
            updatePlayersListUI();
            playerNameInput.value = '';
        }
    }
    
    function updatePlayersListUI() {
        playersList.innerHTML = '';
        players.forEach((p, i) => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${p.avatar} ${p.name}</span>`;
            li.appendChild(Object.assign(document.createElement('button'), {
                className: 'delete-btn', innerHTML: 'ğŸ—‘ï¸', onclick: () => { players.splice(i, 1); updatePlayersListUI(); }
            }));
            playersList.appendChild(li);
        });
        startGameBtn.disabled = players.length < 1;
    }

    function startGame() {
        targetScore = parseInt(targetScoreInput.value) || 150;
        prizeName = prizeNameInput.value.trim();
        displayTargetScore.textContent = targetScore;
        isGameOver = false;
        currentPlayerIndex = 0;
        
        updatePlayerSelect(); 
        updateScoreboardUI();
        updateTurnIndicator();
        
        setupScreen.classList.remove('active');
        setTimeout(() => gameScreen.classList.add('active'), 50); 
    }
    
    function goToSetup() {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ ÙƒÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.")) {
            players = [];
            resetGame(false);
        }
    }
    
    function playAgain() {
        isGameOver = false;
        players.forEach(p => p.score = 0);
        historyLog.innerHTML = '';
        numberDisplay.innerHTML = '&nbsp;';
        gameOverModal.classList.remove('active');
        confettiContainer.innerHTML = '';
        currentPlayerIndex = 0;
        updateScoreboardUI();
        updateTurnIndicator();
    }
    
    function resetGame(confirmFirst = true) {
        if (confirmFirst && !confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ")) return;
        
        playAgain(); 
        
        players = []; 
        currentInput = '';
        playerNameInput.value = '';
        prizeNameInput.value = '';
        playersList.innerHTML = '';
        
        gameScreen.classList.remove('active');
        setTimeout(() => setupScreen.classList.add('active'), 50);
    }
    
    // --- Add Player During Game ---
    function addPlayerDuringGame() {
        const name = ingamePlayerNameInput.value.trim();
        const avatar = ingameAvatarPicker.querySelector('.avatar.selected').textContent;
        if (name && !players.some(p => p.name === name)) {
            players.push({ name, score: 0, avatar });
            ingamePlayerNameInput.value = '';
            updatePlayerSelect();
            updateScoreboardUI();
        } else {
            alert('Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ ÙØ§Ø±Øº!');
        }
    }

    // --- Game Logic ---
    function appendNumber(num) {
        // --- THIS IS THE ONLY CHANGE ---
        if (currentInput === '0' && num === '0') {
            return;
        }
        // ---------------------------------

        if (currentInput.length < 2 && !isGameOver) { 
            playSound(audioClick);
            currentInput += num; 
            numberDisplay.textContent = currentInput; 
        }
    }
    function clearInput() { 
        if(isGameOver) return;
        playSound(audioClick);
        currentInput = ''; 
        numberDisplay.innerHTML = '&nbsp;'; 
    }
    function submitNumber() {
        if (currentInput === '' || isGameOver) return;
        playSound(audioRoll);
        
        const num = parseInt(currentInput);
        const player = players[currentPlayerIndex];
        const score = Math.floor(Math.random() * 56) - 20;
        
        player.score += score;

        if (score >= 0) playSound(audioPositive);
        else playSound(audioNegative);
        
        showFloatingScore(score);
        addToHistory(player.name, num, score);
        updateScoreboardUI(currentPlayerIndex);
        clearInput();
        
        if (player.score >= targetScore) {
            triggerGameOver(player);
        } else {
            currentPlayerIndex = (players.length > 0) ? (currentPlayerIndex + 1) % players.length : 0;
            updateTurnIndicator();
        }
    }

    // --- UI & Effects ---
    playerSelect.addEventListener('change', (event) => {
        currentPlayerIndex = parseInt(event.target.value);
    });
    
    function updateTurnIndicator() {
        if (players.length > 0) {
            playerSelect.selectedIndex = currentPlayerIndex;
        }
    }

    function triggerGameOver(winner) {
        isGameOver = true;
        winnerNameEl.textContent = `${winner.avatar} ${winner.name}`;
        
        if (prizeName) {
            prizeDisplayEl.textContent = `ÙˆÙØ§Ø² Ø¨Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: ${prizeName}`;
            prizeDisplayEl.style.display = 'block';
        } else {
            prizeDisplayEl.style.display = 'none';
        }

        gameOverModal.classList.add('active');
        startConfetti();
    }
    
    function startConfetti() {
        confettiContainer.innerHTML = ''; 
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800'];
        for (let i = 0; i < 150; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = `${Math.random() * 3 + 2}s`; 
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            confettiContainer.appendChild(confetti);
        }
    }
    
    function updatePlayerSelect() {
        const currentSelection = playerSelect.value;
        playerSelect.innerHTML = '';
        players.forEach((p, i) => {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `${p.avatar} ${p.name}`;
            playerSelect.add(option);
        });
        if (currentSelection < players.length) {
            playerSelect.value = currentSelection;
        }
    }
    
    function updateScoreboardUI(highlightedIndex = -1) {
        scoreboard.innerHTML = '';
        const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
        sortedPlayers.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${p.avatar} ${p.name}</span><span class="score">${p.score}</span>`;
            if (players[highlightedIndex] && p.name === players[highlightedIndex].name) {
                li.classList.add('highlight');
                setTimeout(() => li.classList.remove('highlight'), 1500);
            }
            scoreboard.appendChild(li);
        });
    }
    
    function showFloatingScore(score) {
        const scoreEl = Object.assign(document.createElement('div'), { className: 'floating-score' });
        scoreEl.textContent = score >= 0 ? `+${score}` : score;
        scoreEl.classList.add(score >= 0 ? 'positive' : 'negative');
        keypadSection.appendChild(scoreEl);
        setTimeout(() => scoreEl.remove(), 1500);
    }
    
    function addToHistory(playerName, num, score) {
        const li = document.createElement('li');
        li.innerHTML = `<b>${playerName}</b> Ø§Ø®ØªØ§Ø± ${num} (<b>${score >= 0 ? '+' : ''}${score}</b>)`;
        historyLog.prepend(li);
        if (historyLog.children.length > 5) historyLog.lastChild.remove();
    }
    
    function changeTheme(themeClass) { body.className = themeClass; }
</script>
</body>
</html>
